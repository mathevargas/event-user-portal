<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Finalizar Cadastro</title>
    <link rel="stylesheet" href="../assets/css/style.css">

    <script defer src="../assets/js/config.js"></script>
    <script defer src="../assets/js/auth.js"></script>
    <script defer src="../assets/js/security.js"></script>
</head>
<body>

<header class="header">
    <div class="logo">Portal de Eventos</div>
    <nav class="nav"></nav>
</header>

<div class="form-container">
    <h2>Finalizar Cadastro</h2>

    <div class="form-group">
        <label>Email</label>
        <input id="email" disabled>
    </div>

    <div class="form-group">
        <label>Nome</label>
        <input id="nome" placeholder="Seu nome completo">
    </div>

    <div class="form-group">
        <label>Nova senha</label>
        <input id="senha" type="password" placeholder="••••••••">
    </div>

    <div class="form-group">
        <label>Confirmar senha</label>
        <input id="senha2" type="password" placeholder="••••••••">
    </div>

    <button id="btnSalvar" class="btn-full">Salvar e entrar</button>
</div>

<footer class="footer">
    © 2025 Sistema de Eventos
</footer>

<script>
const emailParam = new URLSearchParams(window.location.search).get("email");
document.getElementById("email").value = emailParam ?? "";

document.getElementById("btnSalvar").onclick = async () => {
    const nomeInput = document.getElementById("nome");
    const senhaInput = document.getElementById("senha");
    const senha2Input = document.getElementById("senha2");

    const nomeVal = nomeInput.value.trim();
    const s1 = senhaInput.value.trim();
    const s2 = senha2Input.value.trim();

    if (!nomeVal || !s1 || !s2) {
        alert("Preencha todos os campos.");
        return;
    }

    if (s1 !== s2) {
        alert("As senhas não coincidem.");
        return;
    }

    const resp = await completarCadastro(emailParam, nomeVal, s1);
    if (!resp) {
        alert("Erro ao completar cadastro.");
        return;
    }

    window.location.href = "home.html";
};
</script>

</body>
</html>
